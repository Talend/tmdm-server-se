<?xml version="1.0" encoding="UTF-8"?>
<!-- ====================================================================== 
 20 dÃ©c. 2005 09:21:22                                                        
 
 mdm Service Logging
 
 jfeltesse                                                                
 ====================================================================== -->
 <project name="Logging Service build" xmlns:artifact="antlib:org.apache.maven.artifact.ant" default="all">
    <property file="build.properties" />

    <target name="prepare-maven" if="local.developer.build">
        <path id="maven-ant-tasks.classpath" path="${maven.ant.tasks.file}" />
        <typedef resource="org/apache/maven/artifact/ant/antlib.xml" uri="antlib:org.apache.maven.artifact.ant" classpathref="maven-ant-tasks.classpath" />
    </target>
 	
	<property name="jar" value="zz.30.mdm.service.logging.ejb.jar"/>
 	
 	
  	<property name="version.props" value="version.properties"/>
 	<property name="build.dir" value="${basedir}/target" />
  	<property name="jboss.dir" value="/opt/jboss"/>
  	<property name="jboss.instance.dir" value="${jboss.dir}/server/default"/>
  	<property name="jboss.deploy.dir" value="${jboss.instance.dir}/deploy"/>
  	<property name="jboss.instance.lib" value="${jboss.instance.dir}/lib"/>
 	<property name="mdm.build.version" value="${major}.${minor}.${rev}-r${svn.revision}" />
    <property name="dev.mode.excluded.start" value="" />
    <property name="dev.mode.excluded.end" value="" />
  
  <!-- ================================= 
   target: all              
   ================================= -->
  <target name="all" depends="clean,version,package,undeploy,deploy" />
  
    <target name="clean">
        <antcall target="mvn.invoke">
            <param name="mvn.goal" value="clean" />
        </antcall>
    </target>
    
    <target name="install">
        <antcall target="mvn.invoke">
            <param name="mvn.goal" value="install" />
        </antcall>
    </target>
    
    <target name="compile">
        <antcall target="mvn.invoke">
            <param name="mvn.goal" value="compile" />
        </antcall>
        <copy todir="bin">
            <fileset dir="target/classes" includes="**" />
        </copy>
    </target>
 	
  <target name="version"  description="Maintain build.date property">
   <propertyfile file="${version.props}"  comment="streek build date">
    <entry key="build.date" type="date" value="now" />
   </propertyfile>
  </target>
  
  <target name="package" depends="compile">
	<buildnumber file="${version.props}"/>
  	<property file="${version.props}" />
   	<property name="version.build.new" value="${major}-${minor}-${rev}_${build.number}"  />
	<jar destfile="${jar}">
		<zipfileset dir="src/META-INF" prefix="META-INF">
			<include name="ejb-jar.xml"/>
		</zipfileset>
		<zipfileset dir="src/META-INF" prefix="META-INF">
			<include name="jboss.xml"/>
		</zipfileset>
		<zipfileset dir=".">
			<include name="RELEASE.NOTES"/>
		</zipfileset>
		<zipfileset dir=".">
			<include name="version.properties"/>
		</zipfileset>
		<zipfileset dir="bin" includes="**/ejb/**/*.class"/>
		<zipfileset dir="bin" includes="**/util/**/*.class"/>
		<zipfileset dir="xslt" prefix="com/amalto/service/logging/ejb" includes="**/*.*"/>
	</jar>
  </target>
  
  <target name="undeploy" description="--> remove packages">		
   <delete>
    <fileset dir="${jboss.deploy.dir}" includes="zz.*.mdm.service.logging.ejb.jar"/>
   </delete>
  </target>
  
  <target name="deploy">
   <echo>Deploying build: ${version.build.new}</echo>
   <copy file="zz.30.mdm.service.logging.ejb.jar" tofile="${jboss.deploy.dir}/zz.30.mdm.service.logging.ejb.jar"/>
  </target>
  
 	<target name="mvn.invoke" description="invokes maven" depends="prepare-maven">
        <property environment="env" />

        <artifact:mvn pom="pom.xml" mavenHome="${env.M2_HOME}" fork="true" failonerror="true">
            <arg value="-V" />
            <arg value="-Dmdm.build.dir=${build.dir}" />
            <arg value="-Dmdm.build.version=${mdm.build.version}" />
            <arg value="-Ddev.mode.excluded.start=${dev.mode.excluded.start}" />
            <arg value="-Ddev.mode.excluded.end=${dev.mode.excluded.end}" />
            <arg value="${mvn.goal}" />
        </artifact:mvn>
    </target> 	
 </project>
 